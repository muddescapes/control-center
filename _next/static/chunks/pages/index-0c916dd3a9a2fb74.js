(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9802)}])},9802:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var s,a,l=n(5893),c=n(5675),i=n.n(c),r={src:"/control-center/_next/static/media/muddescapes-logo.3cefb3d3.png",height:251,width:251,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAz0lEQVR42mMAAU1TM35vSwsvJwsLdRC/w8WJlQEZhHt5iTMYmxRpmJpmArnMILH///8zgiWPz5nDBBaIDlM5FxW+a7aP92MRBoZABmRwYsF85w/pKf8++nn+P2Fv/f9YU+P/TVOmNMMVbNu1K3v25Mn/73e0/Xi7etXPVXPn/g+PitoMV7BuzZqc9q6u/+t27vw5ZcGCnyAbjfX12+AKDh85Ii8vLr5r7uzZ/ytKS/9L8vNtj0tIkAFLTps2jQmmcP78+Uk5OTkJML6VlRUTAGOUTyWcm26ZAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},o=n(1616),d=n.n(o),u=n(7294),m=n(9612),p={src:"/control-center/_next/static/media/ellipsis.3f02a75a.svg",height:32,width:32},h={src:"/control-center/_next/static/media/checkmark.8fcaed31.svg",height:24,width:24},f=n(6402);function x(e){let{name:t,value:n}=e;return(0,l.jsxs)("span",{className:"mx-1 p-2 bg-gray-200 rounded-md",children:[(0,l.jsx)("span",{children:t}),(0,l.jsx)("span",{className:"p-1 ml-2 rounded-md "+(n?"bg-green-400":"bg-red-400"),children:n?"TRUE":"FALSE"})]})}function g(e){let{name:t,state:n,onFunctionChangeState:s}=e,c=null;switch(n){case a.Called:c=(0,l.jsx)("span",{className:"absolute flex justify-center align-middle -top-2 -right-2 rounded-full bg-black w-5 h-5",children:(0,l.jsx)(i(),{className:"w-2.5",src:p,alt:"..."})});break;case a.Completed:c=(0,l.jsx)("span",{className:"animate-fade absolute flex justify-center align-middle -top-2 -right-2 rounded-full bg-green-500 w-5 h-5",onAnimationEnd:()=>s(t,a.Idle),children:(0,l.jsx)(i(),{className:"w-2.5",src:h,alt:"checkmark"})})}return(0,l.jsxs)("button",{className:"relative mx-1 p-2 bg-blue-500 rounded-xl text-white transition hover:bg-blue-600",onClick:()=>s(t,a.Called),children:[t,c]})}function b(e){let{puzzle:t,onFunctionChangeState:n}=e;return(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-3xl text-primary",children:t.name}),(0,l.jsx)(f.Z,{className:"text-sm ml-2 text-gray-500",date:t.lastUpdatedAt}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"my-2 text-xl",children:"Variables"}),Array.from(t.variables.entries()).map(e=>{let[t,n]=e;return(0,l.jsx)(x,{name:t,value:n},t)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"my-2 text-xl",children:"Functions"}),Array.from(t.functions.entries()).map(e=>{let[t,s]=e;return(0,l.jsx)(g,{name:t,state:s,onFunctionChangeState:n},t)})]})]})}(s=a||(a={}))[s.Idle=0]="Idle",s[s.Called=1]="Called",s[s.Completed=2]="Completed";var w=n(7596),A=n.n(w);function j(){let[e,t]=u.useState(!1),[n,s]=u.useState([]),{width:c,height:o,ref:p}=(0,m.NB)(),[h,f]=u.useState([]),[x,g]=u.useState(null),w=u.useCallback(function(e,t,n){f(s=>s.some(t=>t.name===e)?s.map(s=>{let a={...s};return a.name===e&&(a.variables.set(t,n),a.lastUpdatedAt=new Date),a}):[...s,{name:e,variables:new Map([[t,n]]),functions:new Map,lastUpdatedAt:new Date}])},[]),j=u.useCallback(function(e,t){f(n=>n.some(t=>t.name===e)?n.map(n=>{let s={...n};return s.name===e&&(s.functions=new Map(t.map(e=>[e,a.Idle])),s.lastUpdatedAt=new Date),s}):[...n,{name:e,variables:new Map,functions:new Map(t.map(e=>[e,a.Idle])),lastUpdatedAt:new Date}])},[]),v=u.useCallback(function(e,t){let n=e.split("/")[2],s=t.toString();f(e=>(e.some(e=>e.name===n)||console.error("Received function call ".concat(s," for puzzle ").concat(n," but puzzle does not exist")),e.map(e=>{let t={...e};return t.name===n&&(t.functions.set(s,a.Called),t.lastUpdatedAt=new Date),t})))},[]),N=u.useCallback(function(e,t){let n=e.split("/"),s=n[2];if(4===n.length){let e=n[3];w(s,e,"1"===t)}else if(A()(3===n.length),t.startsWith("functions:")){let e=t.replace(/^(functions:)/,"").split(",");j(s,e)}else f(e=>(e.some(e=>e.name===s)||console.error("Received function call completion (".concat(t,") for puzzle ").concat(s," but puzzle does not exist")),e.map(e=>{let n={...e};return n.name===s&&n.functions.set(t,a.Completed),n})))},[j,w]);return u.useEffect(()=>{let e=d().connect("wss://broker.hivemq.com:8884",{path:"/mqtt"});return e.on("connect",()=>{console.debug("connected"),t(!0),e.subscribe("muddescapes/control/+",{qos:2}),e.subscribe("muddescapes/data/+",{qos:2}),e.subscribe("muddescapes/data/+/+",{qos:2}),e.publish("muddescapes","",{qos:1})}),e.on("message",(e,t)=>{s(n=>[{time:new Date,topic:e,message:t.toString()},...n]),e.startsWith("muddescapes/control/")?v(e,t.toString()):e.startsWith("muddescapes/data/")&&N(e,t.toString())}),g(e),()=>{e.end()}},[v,N]),(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"flex flex-col max-h-screen",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center px-2 outline outline-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)(i(),{src:r,alt:"MuddEscapes Logo",height:60}),(0,l.jsx)("span",{className:"text-4xl font-semibold",children:"MuddEscapes Control Center"})]}),(0,l.jsx)("div",{className:"h-5 w-5 rounded-full justify-self-end "+(e?"bg-green-500":"bg-red-500")})]}),(0,l.jsxs)("div",{className:"grow w-screen min-h-0 grid grid-rows-3 grid-cols-3",children:[(0,l.jsxs)("div",{className:"row-span-3 col-span-2 overflow-y-scroll pl-5 pt-3 border-r border-black",children:[0===h.length&&(0,l.jsx)("div",{className:"text-2xl font-semibold",children:"No puzzles found"}),h.map((e,t)=>(0,l.jsx)(b,{puzzle:e,onFunctionChangeState:(n,s)=>{if(x){if(s===a.Called){x.publish("muddescapes/control/".concat(e.name),n);return}f(e=>{let a=[...e];return a[t].functions.set(n,s),a})}}},e.name))]}),(0,l.jsx)("div",{className:"row-span-2 border-b border-black font-mono overflow-y-scroll",children:n.map(e=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"font-semibold",children:[e.time.toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})," ",e.topic,":"]}),(0,l.jsx)("p",{children:e.message})]},e.time.getTime()))}),(0,l.jsx)("div",{ref:p,children:(0,l.jsx)("iframe",{className:"origin-top-left",style:{scale:(c&&o?Math.min(c/1280,o/720):0).toString(),width:"".concat(1280,"px"),height:"".concat(720,"px")},src:"https://muddescapes-timer.web.app/"})})]})]})})}},1784:function(){},5036:function(){},2361:function(){},4616:function(){}},function(e){e.O(0,[412,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);